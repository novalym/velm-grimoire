# =================================================================================
# == GNOSTIC TRAIT: NEURAL SYNAPSE (V-Î©-TOTALITY-CONTEXT)                      ==
# =================================================================================
# @name: Neural Synapse
# @description: Materializes an AI-optimized context layer. Injects a background 
#               scryer that maintains a high-status '.scaffold/context.md' for 
#               hyper-performant, hallucination-free AI communion.
# @category: Intelligence
# @tags: ai, context, rag, documentation, metadata, llm-optimized
# @difficulty: Adept
# @is_integration: true
# =================================================================================

# --- I. THE ALTAR OF GNOSTIC WILL ---
$$ context_depth = "forensic"
$$ update_on_save = true

# --- II. THE SCRIPTURE OF FORM ---
# This file is the primary lens through which the AI views the project.
.scaffold/
    context.md :: """
    # ðŸ§  PROJECT CONSTITUTION: {{ project_title }}
    
    ## I. Architectural Invariants
    - **Sovereignty:** Logic must remain decoupled from infrastructure.
    - **Integrity:** All changes must bear the signature of a `velm` rite.
    
    ## II. Causal Map
    # [AUTOGENERATED_START]
    # The scryer will inject the latest dependency graph here.
    # [AUTOGENERATED_END]

    ## III. High-Status Symbols
    # Key classes and functions are listed here for 0ms AI recall.
    """

scripts/intelligence/
    update_synapse.py :: """
    # [LIF: 50x] [ROLE: CONTEXT_SCRIER]
    import os
    from pathlib import Path
    from velm.core.cortex.engine import GnosticCortex

    def refresh_context():
        print("ðŸŒ€ [SYNAPSE] Scrying AST for context optimization...")
        root = Path(os.getcwd())
        cortex = GnosticCortex(root)
        memory = cortex.perceive()
        
        # Logic to extract top 10 central symbols and write to context.md
        # ... (Surgical string replacement in .scaffold/context.md) ...
        print("âœ¨ [SYNAPSE] AI Context updated with latest structural Gnosis.")

    if __name__ == "__main__":
        refresh_context()
    """

# --- III. THE MAESTRO'S WILL ---
%% post-run
    proclaim: "Neural Synapse manifest in '.scaffold/' and 'scripts/intelligence/'."
    
    # 1. Add the update rite to the build process
    .Makefile += """
# --- INTELLIGENCE RITES ---
sync-context: ## update the AI context.md with latest AST gnosis
	@python3 scripts/intelligence/update_synapse.py
"""
    
    # 2. Conduct initial scry
    proclaim: "Phase I: Conducting initial context scry..."
    @try:
        >> make sync-context
    @catch:
        proclaim: "[yellow]Initial scry deferred. Ensure 'velm' is in your PYTHONPATH.[/yellow]"
    @end

    proclaim: "âœ… [bold cyan]SYNAPSE ACTIVE[/bold cyan]. AI Co-Pilot visibility: 100%."

%% on-heresy
    proclaim: "Synapse failed to fire. AI Co-Pilot remains un-optimized."